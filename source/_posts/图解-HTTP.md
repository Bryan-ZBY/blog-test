---
title: 图解-HTTP 
date: 2021-03-14 11:16:26
tags: HTTP
---

### 名词解析
- HTTP: HyperText Transfer Protocol，超文本传输协议
- TCP: Transmission Control Protocol，传输控制协议
- UDP: User Data Protocol，用户数据报协议
- IP: Internet Protocol，网际协议
- FTP: File Transfer Protocol，文件传输协议
- DNS: Domain Name System，域名系统
- URI: Uniform Resource Identifier，统一资源标识符
- URL: Uniform Resource Locator，统一资源定位符

### TCP/IP 协议共有几层
- 应用层：FTP、DNS、HTTP等
- 传输层：TCP、UDP
- 网络层：IP
- 数据链路层

### 什么是字节流服务
按层次分，TCP 位于传输层，提供可靠的字节流服务。
所谓的字节流服务（Byte Stream Service）是指，为了方便传输，将大块数据分割成以报文段（segment）为单位的数据包进行管理。

### URI 和 URL 的区别
URI 用字符串标识某一互联网资源，而 URL 表示资源的地点（互联网上所处的位置）。可见 URL 是 URI 的子集。
假设所有的Html文档都有唯一的编号，记作html:xxxxx，xxxxx是一串数字，即Html文档的身份证号码，这个能唯一标识一个Html文档，那么这个号码就是一个URI。而URL则通过描述是哪个主机上哪个路径上的文件来唯一确定一个资源，也就是定位的方式来实现的URI。

### 请求报文和响应报文的构成
请求报文是由请求方法、请求 URI、协议版本、可选的请求首部字段和内容实体构成的。
响应报文基本上由协议版本、状态码、用以解释状态码的原因短语、可选的响应首部字段以及实体主体构成。

### 持久连接的好处
在 HTTP/1.1 中，所有的连接默认都是持久连接。
持久连接的好处在于减少了 TCP 连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载。
另外，减少开销的那部分时间，使HTTP 请求和响应能够更早地结束，这样 Web 页面的显示速度也就相应提高了。

### 什么是管线化
持久连接使得多数请求以管线化（pipelining）方式发送成为可能。
从前发送请求后需等待并收到响应，才能发送下一个请求。
管线化技术出现后，不用等待响应亦可直接发送下一个请求。
这样就能够做到同时并行发送多个请求，而不需要一个接一个地等待响应了。

### 为什么要使用 Cookie
HTTP 是一种不保存状态，即无状态协议。
HTTP 协议自身不对请求和响应之间的通信状态进行保存。也就是说在 HTTP 这个级别，协议对于发送过的请求或响应都不做持久化处理。也就是说，无法根据之前的状态进行本次的请求处理。
无状态协议当然也有它的优点。由于不必保存状态，自然可减少服务器的 CPU 及内存资源的消耗。更快地处理大量事务，确保协议的可伸缩性。
为了实现期望的保持状态功能，于是引入了 Cookie 技术。有了 Cookie 再用 HTTP 协议通信，就可以管理状态了。

### Cookie 是如何实现的
Cookie 技术通过在请求和响应报文中写入 Cookie 信息来控制客户端的状态。
Cookie 会根据从服务器端发送的响应报文内的一个叫做 Set-Cookie 的首部字段信息，通知客户端保存 Cookie。当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入 Cookie 值后发送出去。
服务器端发现客户端发送过来的 Cookie 后，会去检查究竟是从哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息。

### 编码传输数据的优缺点
HTTP 在传输数据时可以按照数据原貌直接传输，但也可以在传输过程中通过编码提升传输速率。
通过在传输时编码，能有效地处理大量的访问请求。
但是，编码的操作需要计算机来完成，因此会消耗更多的 CPU 等资源。

### 报文主体和实体主体的区别
通常，报文主体等于实体主体。
只有当传输中进行编码操作时，实体主体的内容发生变化，才导致它和报文主体产生差异。
压缩传输时，报文主体为实体主体压缩后的密文。
分块传输时，报文主体为实体主体分割后的一小块。
多部分对象集合传输时，报文主体包含多个实体主体。

### 什么是范围请求
以前，如果下载过程中遇到网络中断的情况，那就必须重头开始。
为了解决上述问题，需要一种可恢复的机制。所谓恢复是指能从之前下载中断处恢复下载。
要实现该功能需要指定下载的实体范围。像这样，指定范围发送的请求叫做范围请求（Range Request）。

### 什么是内容协商机制
内容协商技术有以下 3 种类型。
- 服务器驱动协商（Server-driven Negotiation）
由服务器端进行内容协商。以请求的首部字段为参考，在服务器端自动处理。
- 客户端驱动协商（Agent-driven Negotiation）
由客户端进行内容协商的方式。用户从浏览器显示的可选项列表中手动选择。还可以利用 JavaScript 脚本在 Web 页面上自动进行上述选择。比如按 OS 的类型或浏览器类型，自行切换成 PC 版页面或手机版页面。
- 透明协商（Transparent Negotiation）
是服务器驱动和客户端驱动的结合体，是由服务器端和客户端各自进行内容协商的一种方法。

### 状态码的类别
| |类别|原因短语|
|---|---|---|
|1XX |Informational（信息性状态码） |接收的请求正在处理
|2XX |Success（成功状态码） |请求正常处理完毕
|3XX |Redirection（重定向状态码） |需要进行附加操作以完成请求
|4XX |Client Error（客户端错误状态码） |服务器无法处理请求
|5XX |Server Error（服务器错误状态码） |服务器处理请求出错


### 常用状态码
**2XX——表明请求被正常处理了**
1、200 OK：请求已正常处理。
2、204 No Content：请求处理成功，但没有任何资源可以返回给客户端，一般在只需要从客户端往服务器发送信息，而对客户端不需要发送新信息内容的情况下使用。
3、206 Partial Content：是对资源某一部分的请求，该状态码表示客户端进行了范围请求，而服务器成功执行了这部分的GET请求。响应报文中包含由Content-Range指定范围的实体内容。
**3XX——表明浏览器需要执行某些特殊的处理以正确处理请求**
4、301 Moved Permanently：永久性重定向，请求的资源已经被分配了新的URI，以后应使用资源现在所指的URI。
5、302 Found：临时性重定向。和301相似，但302代表的资源不是永久性移动，只是临时性性质的。换句话说，已移动的资源对应的URI将来还有可能发生改变。
6、303 See Other：资源的URI已更新，你是否能临时按新的URI访问。该状态码表示由于请求对应的资源存在着另一个URL，应使用GET方法定向获取请求的资源。303状态码和302状态码有着相同的功能，但303状态码明确表示客户端应当采用GET方法获取资源，这点与302状态码有区别。
当301,302,303响应状态码返回时，几乎所有的浏览器都会把POST改成GET，并删除请求报文内的主体，之后请求会自动再次发送。
7、304 Not Modified：资源已找到，但未符合条件请求。该状态码表示客户端发送附带条件的请求时（采用GET方法的请求报文中包含If-Match，If-Modified-Since，If-None-Match，If-Range，If-Unmodified-Since中任一首部）服务端允许请求访问资源，但因发生请求未满足条件的情况后，直接返回304.。
8、307 Temporary Redirect：临时重定向。与302有相同的含义。
**4XX——表明客户端是发生错误的原因所在。**
9、400 Bad Request：服务器端无法理解客户端发送的请求，请求报文中可能存在语法错误。
10、401 Unauthorized：该状态码表示发送的请求需要有通过HTTP认证（BASIC认证，DIGEST认证）的认证信息。
11、403 Forbidden：不允许访问那个资源。该状态码表明对请求资源的访问被服务器拒绝了。（权限，未授权IP等）
12、404 Not Found：服务器上没有请求的资源。路径错误等。
**5XX——服务器本身发生错误**
13、500 Internal Server Error：貌似内部资源出故障了。该状态码表明服务器端在执行请求时发生了错误。也有可能是web应用存在bug或某些临时故障。
14、503 Service Unavailable：抱歉，我现在正在忙着。该状态码表明服务器暂时处于超负载或正在停机维护，现在无法处理请求。

### 代理、网关、隧道的特点
代理: 代理是一种有转发功能的应用程序，它扮演了位于服务器和客户端“中间人”的角色，接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端。每次通过代理服务器转发请求或响应时，都会追加写入via首部信息。因此，在转发时会附加via首部字段以标记经过的主机信息。
网关: 网关的工作机制和代理十分相似,而网关能使通信线路上的服务器提供非 HTTP 协议服务。即网关可以将经过的http请求转化为其他协议通信类型。
隧道: 隧道可按要求建立起一条与其他服务器的通信线路，届时使用 SSL 等加密手段进行通信。隧道的目的是确保客户端能与服务器进行安全的通信。隧道本身不会去解析http请求，也就是在传输的时候可以保证数据的原样性。


### HTTP 的缺点
- 通信使用明文（不加密），内容可能会被窃听
- 不验证通信方的身份，因此有可能遭遇伪装
- 无法证明报文的完整性，所以有可能已遭篡改


