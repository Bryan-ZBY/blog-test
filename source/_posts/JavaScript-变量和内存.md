---
title: JavaScript-变量和内存
date: 2021-03-18 21:28:23
tags: JavaScript
---

### 可以给基本类型变量加属性吗
可以加，不会报错，不过瞬间就会被删掉，所以下次无法调用。

### 如何理解函数的参数是按值传递的
把函数外部的值复制给函数内部的参数，就和把值从一个变量复制到另一个变量一样。
基本类型值的传递如同基本类型变量的复制一样，而引用类型值的传递，则如同引用类型变量的复制一样。
在向参数传递引用类型的值时，会把这个值在内存中的地址复制给一个局部变量，因此这个局部变量的变化会反映在函数的外部。

<!-- more -->

### 介绍下instanceof 操作符和 typeof 的区别
typeof 操作符是确定一个变量是字符串、数值、布尔值，还是undefined 的最佳工具。
但在检测引用类型的值时，这个操作符的用处不大。通常，我们并不是想知道某个值是对象，而是想知道它是什么类型的对象。
如果变量是给定引用类型（根据它的原型链来识别；第6 章将介绍原型链）的实例，那么 instanceof 操作符就会返回true。
所有引用类型的值都是Object 的实例。因此，在检测一个引用类型值和Object 构造函数时，instanceof 操作符始终会返回true。
如果使用instanceof 操作符检测基本类型的值，则该操作符始终会返回false，因为基本类型不是对象。

### 关于 var 声明的变量的位置
使用var 声明的变量会自动被添加到最接近的环境中。在函数内部，最接近的环境就是函数的局部环境；在with 语句中，最接近的环境是函数环境。
如果初始化变量时没有使用var 声明，该变量会自动被添加到全局环境。

### 垃圾收集的周期
垃圾收集机制的原理其实很简单：找出那些不再继续使用的变量，然后释放其占用的内存。为此，垃圾收集器会按照固定的时间间隔（或代码执行中预定的收集时间），周期性地执行这一操作。

### 局部变量的生命周期
局部变量只在函数执行的过程中存在。而在这个过程中，会为局部变量在栈（或堆）内存上分配相应的空间，以便存储它们的值。然后在函数中使用这些变量，直至函数执行结束。此时，局部变量就没有存在的必要了，因此可以释放它们的内存以供将来使用。

### 垃圾收集的策略
- 标记清除
当变量进入环境（例如，在函数中声明一个变量）时，就将这个变量标记为“进入环境”。从逻辑上讲，永远不能释放进入环境的变量所占用的内存，因为只要执行流进入相应的环境，就可能会用到它们。而当变量离开环境时，则将其标记为“离开环境”。不过垃圾收集的时间间隔互有不同。
- 引用计数
引用计数的含义是跟踪记录每个值被引用的次数。当声明了一个变量并将一个引用类型值赋给该变量时，则这个值的引用次数就是1。如果同一个值又被赋给另一个变量，则该值的引用次数加1。相反，如果包含对这个值引用的变量又取得了另外一个值，则这个值的引用次数减1。当这个值的引用次数变成0 时，则说明没有办法再访问这个值了，因而就可以将其占用的内存空间回收回来。这样，当垃圾收集器下次再运行时，它就会释放那些引用次数为零的值所占用的内存。

### 什么是循环引用
循环引用指的是对象A 中包含一个指向对象B 的指针，而对象B 中也包含一个指向对象A 的引用。这种情况两个对象的引用次数都是2。
在采用标记清除策略的实现中，由于函数执行之后，这两个对象都离开了作用域，因此这种相互引用不是个问题。但在采用引用计数策略的实现中，当函数执行完毕后，objectA 和objectB 还将继续存在，因为它们的引用次数永远不会是0。
假如这个函数被重复多次调用，就会导致大量内存得不到回收。

### IE8 的循环引用问题
IE 中有一部分对象并不是原生JavaScript 对象。例如，其BOM 和DOM 中的对象就是使用C++以COM（Component Object Model，组件对象模型）对象的形式实现的，而COM 对象的垃圾收集机制采用的就是引用计数策略。因此，即使IE 的JavaScript 引擎是使用标记清除策略来实现的，但JavaScript 访问的COM 对象依然是基于引用计数策略的。换句话说，只要在IE 中涉及COM 对象，就会存在循环引用的问题。IE9 把BOM 和DOM 对象都转换成了真正的JavaScript 对象。

### 如何避免循环引用问题
为了避免这样的循环引用问题，最好是在不使用它们的时候手工断开连接，即将不使用的对象置为 null。将变量设置为null 意味着切断变量与它此前引用的值之间的连接。当垃圾收集器下次运行时，就会删除这些值并回收它们占用的内存。这个做法叫做解除引用。一般局部变量会在它们离开执行环境时自动被解除引用。对于全局变量globalPerson 而言，则需要我们在不使用它的时候手工为它解除引用。

### 解除引用会立刻回收内存吗
解除一个值的引用并不意味着自动回收该值所占用的内存。解除引用的真正作用是让值脱离执行环境，以便垃圾收集器下次运行时将其回收。
